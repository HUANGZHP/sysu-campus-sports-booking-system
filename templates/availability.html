{% extends "base.html" %}
{% block content %}

<style>
    /* 1. é¡¶éƒ¨åœºé¦†ä¿¡æ¯å¡ç‰‡ */
    .venue-header-card {
        background: white;
        border-radius: 16px;
        padding: 25px;
        display: flex;
        gap: 30px;
        align-items: center;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
        border: 1px solid #f0f0f0;
        margin-bottom: 30px;
        position: relative;
        overflow: hidden;
    }
    /* è£…é¥°æ¡ */
    .venue-header-card::before {
        content: ""; position: absolute; left: 0; top: 0; bottom: 0; width: 6px;
        background: #005826;
    }

    .venue-img {
        width: 140px; height: 100px;
        border-radius: 10px; object-fit: cover;
        box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }

    .venue-info h2 { margin: 0 0 8px 0; color: #333; font-size: 24px; }
    .venue-meta { color: #666; font-size: 14px; display: flex; gap: 15px; align-items: center; }
    .venue-price { font-size: 20px; font-weight: bold; color: #d97706; font-family: monospace; }

    /* æ—¥æœŸé€‰æ‹©å™¨ç¾åŒ– */
    .date-picker-box {
        margin-left: auto; /* æ¨åˆ°å³è¾¹ */
        background: #f8fafc;
        padding: 10px 20px;
        border-radius: 12px;
        border: 1px solid #e2e8f0;
        display: flex; flex-direction: column; align-items: flex-start;
    }
    .date-input {
        border: 1px solid #cbd5e1; padding: 8px; border-radius: 6px;
        font-family: inherit; color: #333; outline: none;
        transition: border 0.2s; cursor: pointer;
    }
    .date-input:focus { border-color: #005826; }

    /* 2. æ—¶æ®µç½‘æ ¼å¸ƒå±€ */
    .slots-container {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
        gap: 20px;
    }

    /* å•ä¸ªæ—¶é—´èƒ¶å›Š */
    .time-capsule {
        background: white;
        border-radius: 12px;
        padding: 20px 15px;
        text-align: center;
        border: 2px solid transparent;
        transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        cursor: pointer;
        box-shadow: 0 2px 5px rgba(0,0,0,0.03);
        display: flex; flex-direction: column; justify-content: center; align-items: center;
    }

    /* çŠ¶æ€ï¼šå¯é¢„çº¦ */
    .time-capsule.available {
        border-color: #bbf7d0;
        background: #f0fdf4;
    }
    .time-capsule.available .time-text { color: #15803d; font-weight: 800; font-size: 18px; }
    .time-capsule.available .status-text { color: #16a34a; font-size: 12px; margin-top: 5px; }
    
    /* æ‚¬åœæ•ˆæœ */
    .time-capsule.available:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(22, 163, 74, 0.15);
        border-color: #16a34a;
        background: #16a34a;
    }
    .time-capsule.available:hover .time-text,
    .time-capsule.available:hover .status-text { color: white; }

    /* çŠ¶æ€ï¼šä¸å¯ç”¨ (è¢«é¢„çº¦/å°åœº) */
    .time-capsule.disabled {
        background: #f3f4f6;
        border-color: #e5e7eb;
        cursor: not-allowed;
        opacity: 0.7;
    }
    .time-capsule.disabled .time-text { color: #9ca3af; font-size: 18px; text-decoration: line-through; }
    .time-capsule.disabled .status-text { color: #6b7280; font-size: 12px; margin-top: 5px; font-weight: bold; }
    
    /* çŠ¶æ€ï¼šå°åœºç‰¹åˆ«æ ·å¼ */
    .time-capsule.blocked {
        background: #fef2f2;
        border-color: #fecaca;
    }
    .time-capsule.blocked .status-text { color: #dc2626; }

    /* 3. å¼¹çª—ç¾åŒ– */
    #bookingModal { backdrop-filter: blur(5px); }
    .modal-content {
        background: white; width: 420px; padding: 35px; border-radius: 16px;
        box-shadow: 0 20px 50px rgba(0,0,0,0.2); animation: zoomIn 0.3s;
    }
    @keyframes zoomIn { from {opacity:0; transform:scale(0.9);} to {opacity:1; transform:scale(1);} }
    
    .radio-group { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 20px 0; }
    .radio-option input { display: none; }
    .radio-option .option-box {
        border: 2px solid #e5e7eb; border-radius: 10px; padding: 15px; text-align: center;
        cursor: pointer; transition: 0.2s; color: #64748b;
    }
    .radio-option input:checked + .option-box {
        border-color: #005826; background: #f0fdf4; color: #005826; font-weight: bold;
        box-shadow: 0 4px 10px rgba(0,88,38,0.1);
    }
</style>

<div class="venue-header-card">
    <img src="{{ url_for('static', filename='uploads/' + (field['å›¾ç‰‡'] if field['å›¾ç‰‡'] else 'default.jpg')) }}" class="venue-img">
    
    <div class="venue-info">
        <h2>{{ field['åœºåœ°åç§°'] }}</h2>
        <div class="venue-meta">
            <span><i class="fa-solid fa-location-dot"></i> {{ field['æ ¡åŒº'] }} - {{ field['åœºé¦†åç§°'] }}</span>
            <span class="badge badge-blue">{{ field['è®¾æ–½ç±»å‹'] }}</span>
            <span style="margin-left: 10px; color: #64748b; font-size: 13px;">ğŸ‘¥ å®¹çº³: <strong>{{ field['å¯å®¹çº³äººæ•°'] }}</strong> äºº</span>
        </div>
        <div style="margin-top: 10px;">
            <span class="venue-price">Â¥{{ field['é¢„çº¦ä»·æ ¼'] }}</span> <span style="font-size:12px; color:#999;">/å°æ—¶</span>
        </div>
    </div>

    <div class="date-picker-box">
        <label style="font-size:12px; font-weight:bold; color:#64748b; margin-bottom:5px;">ğŸ“… é¢„çº¦æ—¥æœŸ</label>
        <form method="get">
            <input type="date" name="date" value="{{ date_str }}" class="date-input" onchange="this.form.submit()">
        </form>
    </div>
</div>

<div class="card" style="border:none; box-shadow:none; background:transparent;">
    <div style="display:flex; gap:20px; margin-bottom:20px; padding-left:10px;">
        <div style="display:flex; align-items:center; gap:6px; font-size:13px; color:#64748b;">
            <div style="width:12px; height:12px; background:#16a34a; border-radius:4px;"></div> å¯é¢„çº¦
        </div>
        <div style="display:flex; align-items:center; gap:6px; font-size:13px; color:#64748b;">
            <div style="width:12px; height:12px; background:#e5e7eb; border-radius:4px;"></div> å·²è¢«çº¦
        </div>
        <div style="display:flex; align-items:center; gap:6px; font-size:13px; color:#64748b;">
            <div style="width:12px; height:12px; background:#fecaca; border-radius:4px;"></div> ç»´æŠ¤ä¸­
        </div>
    </div>

    <div class="slots-container">
        {% for s in slots %}
            {% if s['available'] %}
                <div class="time-capsule available" onclick="openModal('{{ s.slot_id }}', '{{ s.start }} - {{ s.end }}')">
                    <div class="time-text">{{ s.start }}</div>
                    <div class="status-text">Â¥{{ field['é¢„çº¦ä»·æ ¼'] }}</div>
                </div>
            {% else %}
                <div class="time-capsule disabled {% if s.reason != 'å·²é¢„çº¦' %}blocked{% endif %}">
                    <div class="time-text">{{ s.start }}</div>
                    <div class="status-text">
                        {% if s.reason == 'å·²é¢„çº¦' %}
                            <i class="fa-solid fa-lock"></i> å·²è¢«çº¦
                        {% else %}
                            <i class="fa-solid fa-ban"></i> {{ s.reason }}
                        {% endif %}
                    </div>
                </div>
            {% endif %}
        {% endfor %}
    </div>
</div>

<div id="bookingModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:9999; align-items:center; justify-content:center;">
    <div class="modal-content">
        <h3 style="margin-top:0; color:#005826; text-align:center;">ğŸ“ ç¡®è®¤é¢„çº¦ä¿¡æ¯</h3>
        
        <form action="{{ url_for('create_booking') }}" method="post">
            <input type="hidden" name="field_id" value="{{ field['åœºåœ°ID'] }}">
            <input type="hidden" name="date" value="{{ date_str }}">
            <input type="hidden" name="slot_id" id="modalSlotId">

            <div style="background:#f8fafc; padding:15px; border-radius:8px; text-align:center; margin-bottom:20px;">
                <div style="font-size:14px; color:#64748b;">{{ date_str }}</div>
                <div style="font-size:24px; font-weight:bold; color:#333; margin:5px 0;" id="modalTimeStr"></div>
                <div style="font-size:14px; color:#005826;">{{ field['åœºé¦†åç§°'] }} - {{ field['åœºåœ°åç§°'] }}</div>
            </div>

            <div style="font-size:13px; font-weight:bold; color:#64748b; margin-bottom:10px;">é€‰æ‹©é¢„çº¦ç±»å‹ï¼š</div>
            <div class="radio-group">
                <label class="radio-option">
                    <input type="radio" name="booking_type" value="ä¸ªäºº" checked>
                    <div class="option-box">
                        <div style="font-size:20px;">ğŸ‘¤</div>
                        <div>ä¸ªäººé¢„çº¦</div>
                    </div>
                </label>
                <label class="radio-option">
                    <input type="radio" name="booking_type" value="ç»„é˜Ÿ">
                    <div class="option-box">
                        <div style="font-size:20px;">ğŸ‘¥</div>
                        <div>å‘èµ·ç»„é˜Ÿ</div>
                    </div>
                </label>
            </div>

            <div style="display:flex; gap:10px; margin-top:30px;">
                <button type="button" onclick="closeModal()" class="btn btn-outline" style="flex:1;">å–æ¶ˆ</button>
                <button type="submit" class="btn" style="flex:1;">ç¡®è®¤æ”¯ä»˜</button>
            </div>
        </form>
    </div>
</div>

<script>
    function openModal(sid, time) {
        document.getElementById('bookingModal').style.display = 'flex';
        document.getElementById('modalSlotId').value = sid;
        document.getElementById('modalTimeStr').innerText = time;
    }
    function closeModal() {
        document.getElementById('bookingModal').style.display = 'none';
    }
    // ç‚¹å‡»èƒŒæ™¯å…³é—­
    document.getElementById('bookingModal').addEventListener('click', function(e){
        if(e.target === this) closeModal();
    });
</script>

{% endblock %}