{% extends "base.html" %}
{% block content %}
<div class="card">
  <h2>管理员控制台</h2>
  <div class="muted">当前登录：{{ user.name }} (管理员)</div>
  
  <h3 style="margin-top: 20px;">今日预约管理</h3>
  
  <table>
    <thead>
      <tr>
        <th>预约ID</th>
        <th>用户</th>
        <th>场地</th>
        <th>时间</th>
        <th>当前状态</th>
        <th>操作 (扣分处罚)</th>
      </tr>
    </thead>
    <tbody>
      {% for r in rows %}
      <tr>
        <td>{{ r['预约ID'] }}</td>
        <td>
          <div>{{ r['姓名'] }}</div>
          <small class="muted">{{ r['学号或工号'] }}</small>
        </td>
        <td>{{ r['场地名称'] }}</td>
        <td>{{ r['预约日期'] }}<br>{{ r['开始时间'] }}-{{ r['结束时间'] }}</td>
        <td>
            {% if r['状态'] == '已预约' %}
                <span style="color: #16a34a; font-weight: bold;">已预约</span>
            {% else %}
                {{ r['状态'] }}
            {% endif %}
        </td>
        <td>
          {% if r['状态'] == '已预约' %}
          <div style="display: flex; gap: 5px;">
            <form method="post" action="{{ url_for('admin_penalize') }}" onsubmit="return confirm('确定标记为【爽约】并扣2分吗？');">
              <input type="hidden" name="booking_id" value="{{ r['预约ID'] }}">
              <input type="hidden" name="type" value="爽约">
              <button type="submit" style="background: #f59e0b; font-size: 12px; padding: 4px 8px;">爽约(-2)</button>
            </form>

            <form method="post" action="{{ url_for('admin_penalize') }}" onsubmit="return confirm('确定标记为【违规】并扣5分吗？');">
              <input type="hidden" name="booking_id" value="{{ r['预约ID'] }}">
              <input type="hidden" name="type" value="违规">
              <button type="submit" style="background: #dc2626; font-size: 12px; padding: 4px 8px;">违规(-5)</button>
            </form>

            <form method="post" action="{{ url_for('admin_penalize') }}" onsubmit="return confirm('确定标记为【顶替】并扣10分吗？');">
              <input type="hidden" name="booking_id" value="{{ r['预约ID'] }}">
              <input type="hidden" name="type" value="顶替">
              <button type="submit" style="background: #7f1d1d; font-size: 12px; padding: 4px 8px;">顶替(-10)</button>
            </form>
          </div>
          {% else %}
            <span class="muted">已处理</span>
          {% endif %}
        </td>
      </tr>
      {% else %}
      <tr><td colspan="6" style="text-align:center; padding:20px;">暂无待处理预约</td></tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}