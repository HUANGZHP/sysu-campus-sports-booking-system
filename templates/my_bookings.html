{% extends "base.html" %}
{% block content %}

<div class="card" style="margin-bottom: 25px; border-left: 5px solid #005826; padding: 20px 25px;">
  <div style="display:flex; justify-content:space-between; align-items:center;">
    <div>
        <h2 style="margin: 0; color: #005826; display: flex; align-items: center; gap: 10px; font-size: 22px;">
            <span style="font-size: 24px;">ğŸ“…</span> æˆ‘çš„é¢„çº¦è®°å½•
        </h2>
        <p class="muted" style="margin: 8px 0 0 0; font-size: 14px; color: #64748b;">
            æŸ¥çœ‹æ‰€æœ‰çš„åœºåœ°é¢„è®¢å†å²ï¼Œå¹¶åœ¨å¼€å§‹å‰ 2 å°æ—¶å†…å–æ¶ˆé¢„çº¦ã€‚
        </p>
    </div>
    <a href="{{ url_for('fields') }}" class="btn" style="box-shadow: 0 4px 6px rgba(0,88,38,0.2); padding: 10px 20px; display: flex; align-items: center; gap: 8px;">
        <i class="fa-solid fa-plus"></i> ç«‹å³é¢„çº¦
    </a>
  </div>
</div>

<div style="display: grid; grid-template-columns: 3fr 1fr; gap: 25px; align-items: start;">

  <div class="card" style="padding: 0; overflow: hidden; border: none; box-shadow: 0 4px 15px rgba(0,0,0,0.05); min-height: 500px;">
    <table class="modern-table" style="margin: 0; width: 100%;">
        <thead>
        <tr style="background: #f8fafc; border-bottom: 2px solid #e2e8f0;">
            <th style="padding: 18px 25px; color: #475569;">é¢„çº¦æ—¶é—´</th>
            <th style="padding: 18px 25px; color: #475569;">åœºåœ°ä¿¡æ¯</th>
            <th style="padding: 18px 25px; color: #475569;">ç±»å‹</th>
            <th style="padding: 18px 25px; color: #475569;">çŠ¶æ€</th>
            <th style="padding: 18px 25px; color: #475569; text-align: right;">æ“ä½œ</th>
        </tr>
        </thead>
        <tbody>
        {% for r in rows %}
        <tr style="border-bottom: 1px solid #f1f5f9; transition: background 0.2s;" onmouseover="this.style.background='#fcfdfe'" onmouseout="this.style.background='transparent'">
            <td style="padding: 18px 25px;">
                <div style="font-weight: 600; color: #1e293b; font-size: 15px; margin-bottom: 4px;">{{ r['é¢„çº¦æ—¥æœŸ'] }}</div>
                <div style="font-size: 13px; color: #64748b; display: flex; align-items: center; gap: 6px;">
                    <i class="fa-regular fa-clock"></i> {{ r['å¼€å§‹æ—¶é—´'] }} - {{ r['ç»“æŸæ—¶é—´'] }}
                </div>
            </td>
            <td style="padding: 18px 25px;">
                <div style="font-weight: 600; color: #005826; font-size: 15px;">{{ r['åœºé¦†åç§°'] }}</div>
                <div style="font-size: 13px; color: #475569; margin-top: 4px;">
                    <span class="badge badge-gray" style="font-weight: normal;">{{ r['åœºåœ°åç§°'] }}</span>
                    <span class="muted" style="margin-left: 5px;">{{ r['æ ¡åŒº'] }}</span>
                </div>
            </td>
            <td style="padding: 18px 25px;">
                {% if r['é¢„çº¦ç±»å‹'] == 'ä¸ªäºº' %}<span class="badge badge-blue">ğŸ‘¤ ä¸ªäºº</span>
                {% elif r['é¢„çº¦ç±»å‹'] == 'ç»„é˜Ÿ' %}<span class="badge badge-purple">ğŸ‘¥ ç»„é˜Ÿ</span>
                {% else %}<span class="badge badge-gray">ğŸ¢ ç»„ç»‡</span>{% endif %}
            </td>
            <td style="padding: 18px 25px;">
                {% if r['çŠ¶æ€']=='å·²é¢„çº¦' %}
                    <span class="badge badge-green" style="padding: 5px 10px;"><i class="fa-solid fa-check"></i> æˆåŠŸ</span>
                {% elif r['çŠ¶æ€']=='å·²å–æ¶ˆ' %}
                    <span class="badge badge-gray" style="padding: 5px 10px; background: #f1f5f9; color: #94a3b8;"><i class="fa-solid fa-ban"></i> å–æ¶ˆ</span>
                {% else %}<span class="badge badge-red">{{ r['çŠ¶æ€'] }}</span>{% endif %}
            </td>
            <td style="padding: 18px 25px; text-align: right;">
                {% if r['çŠ¶æ€'] == 'å·²é¢„çº¦' %}
                <div style="display: flex; justify-content: flex-end; gap: 8px; align-items: center;">
                    {% if r['é¢„çº¦è€…id'] == user.user_id %}
                        <form method="post" action="{{ url_for('cancel_booking', booking_id=r['é¢„çº¦ID']) }}" onsubmit="return confirm('ç¡®å®šå–æ¶ˆæ•´å•ï¼Ÿ');">
                            <button type="submit" class="btn btn-sm btn-cancel-custom">å–æ¶ˆ</button>
                        </form>
                        {% if r['é¢„çº¦ç±»å‹'] == 'ç»„é˜Ÿ' %}
                        <a href="{{ url_for('team_manage', booking_id=r['é¢„çº¦ID']) }}" class="btn btn-sm btn-team-custom">é˜Ÿä¼</a>
                        {% endif %}
                    {% else %}
                        <form method="post" action="{{ url_for('cancel_booking', booking_id=r['é¢„çº¦ID']) }}" style="display:flex; gap:5px; align-items:center;">
                            <input name="reason" placeholder="é€€å‡ºåŸå› ..." style="width:80px; padding:4px; font-size:11px; border:1px solid #ddd; border-radius:4px;">
                            <button type="submit" class="btn btn-sm btn-cancel-custom" onclick="return confirm('ç¡®å®šé€€å‡ºï¼Ÿ');">é€€å‡º</button>
                        </form>
                    {% endif %}
                </div>
                {% else %}<span class="muted" style="font-size: 20px; opacity: 0.2;">-</span>{% endif %}
            </td>
        </tr>
        {% endfor %}
        </tbody>
    </table>
  </div>

  <div class="card" style="padding: 0; overflow: hidden; border: none; box-shadow: 0 4px 20px rgba(0,88,38,0.15); position: sticky; top: 80px;">
    <div style="background: linear-gradient(135deg, #005826 0%, #047857 100%); color: white; padding: 25px 20px; text-align: center;">
        <h3 style="margin: 0; font-size: 26px; font-weight: 800; letter-spacing: 1px;">{{ calendar.year }} . {{ calendar.month }}</h3>
        <p style="margin: 8px 0 0 0; opacity: 0.9; font-size: 13px; font-weight: 500;">KEEP MOVING</p>
    </div>
    <div style="padding: 25px 20px; background: white;">
        <div style="display: grid; grid-template-columns: repeat(7, 1fr); text-align: center; margin-bottom: 15px; font-weight: bold; color: #94a3b8; font-size: 12px;">
            <span>ä¸€</span><span>äºŒ</span><span>ä¸‰</span><span>å››</span><span>äº”</span><span>å…­</span><span>æ—¥</span>
        </div>
        <div style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 10px; text-align: center;">
            {% for _ in range(calendar.start_weekday) %}<div></div>{% endfor %}
            {% for day in range(1, calendar.total_days + 1) %}
                {% if day in calendar.active_days %}
                    <div style="width: 30px; height: 30px; line-height: 30px; background: #005826; color: white; border-radius: 50%; margin: 0 auto; font-weight: bold; font-size: 13px; box-shadow: 0 3px 8px rgba(0,88,38,0.3); transform: scale(1.1);">{{ day }}</div>
                {% else %}
                    <div style="width: 30px; height: 30px; line-height: 30px; color: #64748b; font-size: 13px;">{{ day }}</div>
                {% endif %}
            {% endfor %}
        </div>
    </div>
    <div style="background: #f0fdf4; padding: 20px; border-top: 1px solid #dcfce7; text-align: center;">
        <div style="color: #166534; font-weight: bold; font-size: 16px; margin-bottom: 5px;">
            æœ¬æœˆè¿åŠ¨ <span style="font-size: 24px; color: #005826; font-family: Impact, sans-serif;">{{ calendar.count }}</span> å¤©
        </div>
        <div style="color: #15803d; font-size: 13px;">
            {% if calendar.count == 0 %}ğŸ—“ï¸ æš‚æ— è®°å½•ï¼Œå¿«å»é¢„çº¦å§ï¼
            {% elif calendar.count < 5 %}ğŸŒŸ èµ·æ­¥ä¸é”™ï¼Œç»§ç»­åšæŒï¼
            {% else %}ğŸ”¥ è¿åŠ¨è¾¾äººï¼ŒåŠ¿ä¸å¯æŒ¡ï¼{% endif %}
        </div>
    </div>
  </div>
</div>

<style>
    .btn-cancel-custom { background: white !important; border: 1px solid #fecaca !important; color: #dc2626 !important; }
    .btn-cancel-custom:hover { background: #fee2e2 !important; }
    .btn-team-custom { background: white !important; border: 1px solid #bfdbfe !important; color: #1d4ed8 !important; text-decoration: none; }
    .btn-team-custom:hover { background: #eff6ff !important; }
</style>
{% endblock %}